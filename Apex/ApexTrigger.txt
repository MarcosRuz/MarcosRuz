// Operação Costura e Máquina Inventário Precisa Ter Apenas 1 Ocorrência em Máquina Operacional
// Impede Duplicidade de Desta Configuração nas Ações de Inclusão e Alteração de Uma Máquina Operacional

trigger DuplicidadeMaquinaOperacional on Maquina_Operacional__c ( before insert, before update ) {
     for ( Maquina_Operacional__c mo : Trigger.new ) {
         Integer i = [ SELECT COUNT()
                       FROM   Maquina_Operacional__c
                       WHERE  Operacao_Costura__c   = :mo.Operacao_Costura__c
                       AND    Maquina_Inventario__c = :mo.Maquina_inventario__c ];
         if ( Trigger.isInsert ) {                              
            if ( i > 0 ) {
               mo.Operacao_Costura__c.addError ('Configuração Máquina '      +
                                                'Operacional Já Existente. ' +
                                                'Inclusão Não Permitida.'  );
            }
         }
         if ( Trigger.isUpdate ) {                              
            if ( i > 1 ) {
               mo.Operacao_Costura__c.addError ('Configuração Máquina '      +
                                                'Operacional Já Existente. ' +
                                                'Alteração Não Permitida.' );
            }
         }
     }
}